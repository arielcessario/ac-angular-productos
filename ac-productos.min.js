(function(){"use strict";var scripts=document.getElementsByTagName("script");var currentScriptPath=scripts[scripts.length-1].src;angular.module("acProductos",["ngCookies"]).factory("ProductService",ProductService).service("ProductVars",ProductVars);ProductService.$inject=["$http","$cookieStore","store","ProductVars","$cacheFactory"];function ProductService($http,$cookieStore,store,ProductVars,$cacheFactory){var service={};var url=currentScriptPath.replace("ac-productos.js","/includes/ac-productos.php");service.getLogged=getLogged;service.setLogged=setLogged;service.checkLastLogin=checkLastLogin;service.create=create;service.remove=remove;service.update=update;service.get=get;service.getById=getById;service.getByEmail=getByEmail;service.login=login;service.logout=logout;service.productExist=productExist;service.forgotPassword=forgotPassword;service.goToPagina=goToPagina;service.next=next;service.prev=prev;return service;function remove(usuario_id,callback){return $http.post(url,{"function":"remove",usuario_id:usuario_id}).success(function(data){if(data!=="false"){callback(data)}}).error(function(data){callback(data)})}function get(callback){var urlGet=url+"?function=get";var $httpDefaultCache=$cacheFactory.get("$http");var cachedData=[];if($httpDefaultCache.get(urlGet)!=undefined){if(ProductVars.clearCache){$httpDefaultCache.remove(urlGet)}else{cachedData=$httpDefaultCache.get(urlGet);callback(cachedData);return}}return $http.get(urlGet,{cache:true}).success(function(data){$httpDefaultCache.put(urlGet,data);ProductVars.clearCache=false;ProductVars.paginas=data.length%ProductVars.paginacion==0?parseInt(data.length/ProductVars.paginacion):parseInt(data.length/ProductVars.paginacion)+1;callback(data)}).error(function(data){callback(data);ProductVars.clearCache=false})}function getById(id,callback){get(function(data){var response=data.filter(function(elem,index,array){return elem.usuario_id==id})[0];callback(response)})}function checkLastLogin(){}function productExist(mail,callback){return $http.post(url,{"function":"existeUsuario",mail:mail}).success(function(data){callback(data)}).error(function(data){})}function logout(){store.remove("jwt");$cookieStore.remove("product");ProductVars.clearCache=true}function login(mail,password,sucursal_id,callback){return $http.post(url,{"function":"login",mail:mail,password:password,sucursal_id:sucursal_id}).success(function(data){if(data!=-1){$cookieStore.put("product",data.product);store.set("jwt",data.token)}callback(data)}).error(function(data){callback(data)})}function create(usuario,callback){return $http.post(url,{"function":"create",product:JSON.stringify(usuario)}).success(function(data){ProductVars.clearCache=true;callback(data)}).error(function(data){ProductVars.clearCache=true;callback(data)})}function getLogged(){var globals=$cookieStore.get("product");if(globals!==undefined&&globals.product!==undefined){return globals}else{return false}}function setLogged(product){$cookieStore.set("product",product)}function changePassword(usuario_id,pass_old,pass_new,callback){return $http.post(url,{"function":"changePassword",usuario_id:usuario_id,pass_old:pass_old,pass_new:pass_new}).success(function(data){ProductVars.clearCache=true;callback(data)}).error(function(data){callback(data)})}function getByEmail(mail,callback){get(function(data){var response=data.filter(function(elem,index,array){return elem.mail==mail})[0];callback(response)})}function update(usuario,callback){return $http.post(url,{"function":"update",product:JSON.stringify(usuario)}).success(function(data){ProductVars.clearCache=true;callback(data)}).error(function(data){callback(data)})}function forgotPassword(email,callback){return $http.post(url,{"function":"forgotPassword",email:email}).success(function(data){callback(data)}).error(function(data){callback(data)})}function goToPagina(pagina){if(isNaN(pagina)||pagina<1){ProductVars.pagina=1;return ProductVars}if(pagina>ProductVars.paginas){ProductVars.pagina=ProductVars.paginas;return ProductVars}ProductVars.pagina=pagina-1;ProductVars.start=ProductVars.pagina*ProductVars.paginacion;return ProductVars}function next(){if(ProductVars.pagina+1>ProductVars.paginas){return ProductVars}ProductVars.start=ProductVars.pagina*ProductVars.paginacion;ProductVars.pagina=ProductVars.pagina+1;return ProductVars}function prev(){if(ProductVars.pagina-2<0){return ProductVars}ProductVars.start=(ProductVars.pagina-2)*ProductVars.paginacion;ProductVars.pagina=ProductVars.pagina-1;return ProductVars}}ProductVars.$inject=[];function ProductVars(){this.paginas=1;this.pagina=1;this.paginacion=10;this.start=0;this.clearCache=true;this.loginPath="/login"}})();